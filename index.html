<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulário de Cadastro</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .dropzone {
      border: 2px dashed #0087f7;
      background: #f0f8ff;
      padding: 10px;
    }
    .dropzone-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    label {
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    button {
      padding: 10px 20px;
      background-color: #0087f7;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
  </style>
</head>

<body>

  <h2>Formulário de Cadastro</h2>

  <form id="formulario">
    <div class="form-group">
      <label>Nome:</label>
      <input type="text" name="nome" required />
    </div>

    <div class="form-group">
      <label>Email:</label>
      <input type="email" name="email" required />
    </div>

    <div class="form-group">
      <label>CEP:</label>
      <input type="text" name="cep" id="cep" required />
    </div>

    <div class="form-group">
      <label>Endereço:</label>
      <input type="text" name="endereco" id="endereco" required />
    </div>

    <div class="form-group">
      <label>Nome do Banco:</label>
      <select name="banco" required>
        <option value="">Selecione</option>
        <option value="001 - Banco do Brasil">001 - Banco do Brasil</option>
        <option value="033 - Santander">033 - Santander</option>
        <option value="104 - Caixa Econômica Federal">104 - Caixa</option>
        <option value="237 - Bradesco">237 - Bradesco</option>
        <option value="341 - Itaú">341 - Itaú</option>
        <option value="260 - Nubank">260 - Nubank</option>
        <option value="290 - PagBank">290 - PagBank</option>
        <option value="136 - C6 Bank">136 - C6 Bank</option>
        <option value="380 - PicPay">380 - PicPay</option>
        <option value="746 - Banco Modal">746 - Banco Modal</option>
      </select>
    </div>

    <h3>Documentos:</h3>
    <div class="dropzone-container">
      <div class="dropzone" id="doc1"></div>
      <div class="dropzone" id="doc2"></div>
      <div class="dropzone" id="doc3"></div>
    </div>

    <br />
    <button type="submit">Enviar</button>
  </form>

  <script>
    // Configuração do EmailJS
    (function() {
      emailjs.init("public_wOBAS86kcTxkqA1yF"); // Substituir pelo seu User ID do EmailJS
    })();

    // Configuração do Dropzone + Upload para Cloudinary
    const cloudName = "dz4th0dhg";
    const uploadPreset = "meu_preset";

    const dropzones = ["doc1", "doc2", "doc3"].map(id => {
      return new Dropzone(`#${id}`, {
        url: `https://api.cloudinary.com/v1_1/${cloudName}/upload`,
        uploadMultiple: false,
        maxFiles: 1,
        acceptedFiles: "image/*,application/pdf",
        params: {
          upload_preset: uploadPreset,
        }
      });
    });

    // Busca CEP
    document.getElementById('cep').addEventListener('blur', async function() {
      const cep = this.value.replace(/\D/g, '');
      if (cep.length === 8) {
        try {
          const res = await axios.get(`https://viacep.com.br/ws/${cep}/json/`);
          if (!res.data.erro) {
            document.getElementById('endereco').value =
              `${res.data.logradouro}, ${res.data.bairro}, ${res.data.localidade} - ${res.data.uf}`;
          } else {
            alert('CEP não encontrado');
          }
        } catch {
          alert('Erro ao buscar o CEP');
        }
      }
    });

    // Envio do formulário
    document.getElementById('formulario').addEventListener('submit', async function(e) {
      e.preventDefault();

      const nome = this.nome.value;
      const email = this.email.value;
      const cep = this.cep.value;
      const endereco = this.endereco.value;
      const banco = this.banco.value;

      // Espera os uploads terminarem
      const uploadPromises = dropzones.map(dz => {
        const file = dz.files[0];
        return file ? file.upload.filename ? file.upload.filename : file.upload.url : null;
      });

      const links = dropzones.map(dz => dz.files[0]?.upload?.url || "Não enviado");

      const templateParams = {
        nome,
        email,
        cep,
        endereco,
        banco,
        documento_1: links[0],
        documento_2: links[1],
        documento_3: links[2],
      };

      try {
        await emailjs.send('service_jsgij9b', 'template_ioktwht', templateParams);
        alert('Formulário enviado com sucesso!');
        this.reset();
        dropzones.forEach(dz => dz.removeAllFiles());
      } catch (error) {
        console.error('Erro ao enviar', error);
        alert('Erro ao enviar. Tente novamente.');
      }
    });
  </script>
</body>
</html>
